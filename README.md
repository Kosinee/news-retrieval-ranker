# ğŸ§  News Retrieval & Ranking System (MLOps Project)

## ğŸ“Œ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
Ğ¦ĞµĞ»ÑŒ â€” Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½Ñ‡Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ **Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¸ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹**,  
ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ ÑƒĞ¼ĞµĞµÑ‚:
1. Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğ½Ğ´Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ğ² (retrieval);
2. Ğ¸Ñ… Ğ¿ĞµÑ€ĞµÑƒĞ¿Ğ¾Ñ€ÑĞ´Ğ¾Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒ (reranking);
3. Ğ¾Ğ±ÑƒÑ‡Ğ°Ñ‚ÑŒÑÑ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ **continuous training** Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¼ Ğ»Ğ¾Ğ³Ğ°Ğ¼.

ĞÑĞ½Ğ¾Ğ²Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â€” **[MIND Dataset (Microsoft News)](https://msnews.github.io/)**,  
Ğ² ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑÑ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ ĞºĞ»Ğ¸ĞºĞ¸ (impressions).

---

## ğŸ’¼ Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ñ†ĞµĞ»ÑŒ
Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ **CTR (Click-Through Rate)** Ğ¸ **Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡Ñ‘Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹**  
Ğ·Ğ° ÑÑ‡Ñ‘Ñ‚ Ğ±Ğ¾Ğ»ĞµĞµ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾Ğ¹ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹ Ğ½Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ.  
Ğ¦ĞµĞ»ÑŒ:
- +10-15 % CTR uplift Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ baseline (BM25),
- ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ Ğ½ĞµĞ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ² top-5.

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ°

           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  User Query / Contextâ”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          Candidate Generation     â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  â€¢ BM25 (keyword retriever)       â”‚
    â”‚  â€¢ DSSM_sem (semantic bi-encoder) â”‚
    â”‚  â€¢ DSSM_pref (behavioral bi-encoder)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          Ranking Layer (LTR)      â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  LightGBM LambdaMART Ranker       â”‚
    â”‚  Ğ¤Ğ¸Ñ‡Ğ¸:                            â”‚
    â”‚   â€“ ÑĞºĞ¾Ñ€Ñ‹ retrievers              â”‚
    â”‚   â€“ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğµ (CTR_doc, freq) â”‚
    â”‚   â€“ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ / Ğ±Ğ¸Ğ·Ğ½ĞµÑ       â”‚
    â”‚   â€“ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        Continuous Training Loop   â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  1. ÑĞ±Ğ¾Ñ€ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ²              â”‚
    â”‚  2. Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…             â”‚
    â”‚  3. Ğ¿ĞµÑ€ĞµĞ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ retrievers/LTR   â”‚
    â”‚  4. Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## ğŸ§© ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### 1ï¸âƒ£ Candidate Generators
| ĞœĞ¾Ğ´ĞµĞ»ÑŒ | Ğ¢Ğ¸Ğ¿ | Ğ¦ĞµĞ»ÑŒ | Ğ›Ğ¾ÑÑ | ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ |
|--------|------|------|------|------------------|
| **BM25** | Keyword | Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ baseline | â€” | Recall@100 |
| **DSSM_sem** | Bi-encoder | ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ±Ğ»Ğ¸Ğ·Ğ¾ÑÑ‚ÑŒ | `InfoNCE` | Recall@K, MRR |
| **DSSM_pref** | Bi-encoder | Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ ĞºĞ»Ğ¸ĞºĞ°Ğ¼ | `TripletLoss` | Recall@K, NDCG@K |

---

### 2ï¸âƒ£ Reranker / Ranker
| ĞœĞ¾Ğ´ĞµĞ»ÑŒ | Ğ¢Ğ¸Ğ¿ | Ğ›Ğ¾ÑÑ | ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ | ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ |
|--------|------|------|---------------|----------|
| **LightGBM LambdaMART** | Listwise Ranker | `LambdaMART Loss` (Ğ²Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹ pairwise-Ğ»Ğ¾Ğ³Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹) | NDCG | NDCG@10, MRR |

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸:**
- ÑĞºĞ¾Ñ€Ñ‹ Ğ¾Ñ‚ BM25, DSSM_sem, DSSM_pref;  
- CTR Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ¸Ñ‡Ğ¸);  
- ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ / Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ (ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ);  
- Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ†Ğ¸Ğ¸: `(query_category == doc_category)`, `(score_sem Ã— score_pref)` Ğ¸ Ğ´Ñ€.

---

## ğŸ§® Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑŒ

| Ğ­Ñ‚Ğ°Ğ¿ | Ğ›Ğ¾ÑÑ | Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° | Ğ§Ñ‚Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ |
|------|------|----------|------------------|
| Retriever | **InfoNCE** | ![formula](https://latex.codecogs.com/svg.image?L=-\log\frac{e^{sim(q,d^+)/\tau}}{\sum_j e^{sim(q,d_j)/\tau)}) | Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ…Ğ¾Ğ´ÑÑ‚Ğ²Ğ° Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ€ |
| Retriever | **TripletLoss** | ![formula](https://latex.codecogs.com/svg.image?L=\max(0,m-sim(q,d^%2B)%2Bsim(q,d^-))) | margin Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹Ğ¼ Ğ¸ Ğ½ĞµÑ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹Ğ¼ |
| Ranker | **LambdaMART** | ![formula](https://latex.codecogs.com/svg.image?L=\sum_{i<j}|\Delta%20NDCG_{ij}|\log(1&plus;e^{-(s_i-s_j)}) ) | ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ° (NDCG) |

---

## ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸

| Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ | ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ | Ğ¦ĞµĞ»ĞµĞ²Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ |
|----------|----------|---------------|------------------|
| **Retriever** | Recall@100, MRR@10 | Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚Ğ° Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ½Ğ°Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹Ñ… | Recallâ‰¥0.9, MRRâ‰ˆ0.35 |
| **Ranker** | NDCG@10, MRR@10 | ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ° Ğ² Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğµ | NDCG@10â‰ˆ0.55 |
| **Ğ‘Ğ¸Ğ·Ğ½ĞµÑ** | CTR, Dwell Time | Ğ²Ğ¾Ğ²Ğ»ĞµÑ‡Ñ‘Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ | +10â€“15 % CTR uplift |
| **Ğ¡ĞµÑ€Ğ²Ğ¸ÑĞ½Ñ‹Ğµ** | Latency P95, Drift | ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ° | â‰¤ 200 Ğ¼Ñ, Î”NDCG < 5 % |

---

## ğŸ” Continuous Training Workflow

1. **Ğ¡Ğ±Ğ¾Ñ€ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ²** Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½-Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° (Ğ¸Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸, ĞºĞ»Ğ¸ĞºĞ¸).  
2. **Data Prep Job** â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† features.  
3. **Retraining retrievers** (DSSM_sem / DSSM_pref) Ğ¿Ğ¾ ÑĞ²ĞµĞ¶Ğ¸Ğ¼ Ğ»Ğ¾Ğ³Ğ°Ğ¼.  
4. **Retraining ranker** (LightGBM LambdaMART).  
5. **Evaluation** Ğ½Ğ° hold-out Ğ½ĞµĞ´ĞµĞ»Ğµ.  
6. **Auto-deploy** Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¿Ñ€Ğ¸ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğ¸ NDCG@10 > threshold.  

---

## âš™ï¸ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ½Ğ¶Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ° (LightGBM)

```python
import lightgbm as lgb

params = {
    "objective": "lambdarank",
    "metric": "ndcg",
    "ndcg_eval_at": [10],
    "num_leaves": 63,
    "learning_rate": 0.05,
    "feature_fraction": 0.9
}

train = lgb.Dataset(X_train, label=y_train, group=group_train)
valid = lgb.Dataset(X_valid, label=y_valid, group=group_valid)

model = lgb.train(params, train, valid_sets=[valid],
                  num_boost_round=200, early_stopping_rounds=30)
